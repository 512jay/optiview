# OptiView Design Philosophy and Setup Insights

## 🎯 Purpose of OptiView
OptiView is designed to serve as the **analysis and prediction layer** for results generated by OptiBatch, a strategy optimization engine for MetaTrader 5 (MT5). While OptiBatch handles raw data generation (e.g. testing different parameter sets across symbols), OptiView helps the user:

- Discover which parameter sets are worth deploying in the market.
- Visualize confidence and prediction quality across strategies.
- Track walk-forward validation performance.

OptiView is not just a dashboard — it's a decision support system.

---

## 🧠 Key Concepts Behind OptiView

### 1. **Walk-Forward Prediction**
OptiView uses a simple but powerful assumption: if a parameter set performs well historically, and if our model can generalize across time, we should be able to predict which configurations will perform well *next month*.

Each month, OptiView:
- Trains a model using prior months' results (per symbol).
- Predicts the top N parameter sets for the next month.
- Annotates actual results later when the next month’s data is available.

---

### 2. **Model Confidence and Quality Tracking**
Predictions are scored using two distinct ideas:

- **Confidence**: how reliable the model *thinks* its prediction is (based on training).
- **Quality**: how well the prediction *actually* performed (evaluated retrospectively).

These are reflected as star ratings (`★`, `☆`) and numeric scores.

---

### 3. **Multi-Model Evaluation**
OptiView uses six different machine learning models to make predictions:

🧠 Supported models:
- **XGBoost** (`xgb`): Great for non-linear data and highly performant.
- **Random Forest** (`rf`): Robust and interpretable.
- **Gradient Boosting** (`gbr`): Slower but accurate.
- **Histogram Gradient Boosting** (`histgb`): Fast, scikit-learn native.
- **LightGBM** (`lgbm`): Fast with large datasets.
- **CatBoost** (`cat`): Good for categorical data.

Each model is trained separately per symbol/month using prior backtest data, and produces its own set of predictions.

These predictions are then:
- Annotated with actual performance (after the month finishes)
- Scored by quality (predictive accuracy)
- Ranked by confidence and predicted profit

This allows the user to compare models and determine which is most reliable over time.

---

### 4. **Decoupled Architecture**
- OptiBatch owns the database schema (`jobs`, `runs`, etc.).
- OptiView reads from and optionally writes to the same database, but only manages its own tables (e.g. `predictions`, `annotations`).

This separation of concerns ensures clear ownership and avoids schema collisions.

---

## 🖥 How "View Predictions" Works

The "View Predictions" tab in the Streamlit dashboard allows users to explore prediction results by:

- **Symbol** (e.g. EURUSD, GBPUSD)
- **Month** (e.g. 2025-01, 2025-02)
- **Model** (e.g. xgb, cat, rf...)

For each selected combination, the app:
- Loads top-ranked predictions
- Joins annotations (if available)
- Displays the following for each config:
  - `✔️` recommended pick (based on confidence + predicted profit)
  - `mod` model used
  - `strat` expert or strategy used (when tracked)
  - `prof` predicted profit
  - `conf` confidence score
  - `★` confidence star rating
  - `actp` actual profit (if annotated)
  - `qual` quality score
  - `☆` quality star rating
  - all `input_` parameters used for the configuration

The table is sortable and highlights the top configuration per model with a ✅.

---

### 📷 Example Screenshot (mocked)
```
| ✔️ | mod | strat        | prof   | conf | ★     | actp   | qual | ☆     | rnk | input_StopLoss | input_TakeProfit |
|----|-----|--------------|--------|------|-------|--------|------|-------|-----|----------------|------------------|
| ✅ | xgb | IndyTSL_v2_0 | 210.55 | 0.88 | ★★★★☆ | 208.03 | 0.75 | ★★★☆☆ | 1   | 30             | 80               |
|    | rf  | IndyTSL_v2_0 | 198.20 | 0.85 | ★★★★☆ | 195.10 | 0.73 | ★★★☆☆ | 2   | 35             | 90               |
|    | cat | IndyTSL_v2_0 | 185.10 | 0.72 | ★★★☆☆ | 180.00 | 0.60 | ★★☆☆☆ | 3   | 25             | 70               |
```

---

### 📖 Walkthrough Tutorial

1. **Launch the App**
   ```bash
   poetry run streamlit run src/optiview/ui/OptiView.py
   ```

2. **Select a Symbol**
   - Dropdown shows full names like `EURUSD`, `GBPUSD`, etc.

3. **Select a Month**
   - Displays all months with predictions for